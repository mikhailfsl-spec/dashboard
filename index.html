<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>My Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --border:#1f2937;
      --text:#e5e7eb;
      --muted:#94a3b8;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }
    header{
      padding:16px 20px;
      border-bottom:1px solid var(--border);
      font-weight:700;
      font-size:20px;
    }
    .wrap{
      padding:18px;
      max-width:1200px;
      margin:0 auto;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px 16px 14px;
      box-shadow:0 12px 30px rgba(0,0,0,0.25);
      min-height:92px;
    }
    .kicker{
      font-size:12px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:6px;
    }
    .sub{
      font-size:12px;
      color:var(--muted);
      margin-top:-2px;
    }
    .value{
      font-size:34px;
      font-weight:800;
      margin-top:8px;
      line-height:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .value.small{ font-size:30px; }
    .foot{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
    }
  </style>
</head>

<body>
  <header>My Dashboard</header>
  <div class="wrap">
    <div class="grid">

      <!-- Prices -->
      <div class="card">
        <div class="kicker">Bitcoin</div>
        <div class="sub">BTC / USD (Coinbase)</div>
        <div class="value" id="btc">—</div>
      </div>

      <div class="card">
        <div class="kicker">Gold</div>
        <div class="sub">USD / oz (daily)</div>
        <div class="value" id="gold">—</div>
      </div>

      <div class="card">
        <div class="kicker">Brent</div>
        <div class="sub">USD / bbl (24h delayed, MetalpriceAPI via Worker)</div>
        <div class="value" id="brent">—</div>
      </div>

      <div class="card">
        <div class="kicker">FX</div>
        <div class="sub">GBP → USD</div>
        <div class="value" id="fx">—</div>
      </div>

      <!-- Clocks -->
      <div class="card">
        <div class="kicker">GMT</div>
        <div class="sub">Etc/GMT</div>
        <div class="value small" id="t_gmt">—</div>
      </div>

      <div class="card">
        <div class="kicker">London</div>
        <div class="sub">Europe/London</div>
        <div class="value small" id="t_london">—</div>
      </div>

      <div class="card">
        <div class="kicker">Moscow</div>
        <div class="sub">Europe/Moscow</div>
        <div class="value small" id="t_moscow">—</div>
      </div>

      <div class="card">
        <div class="kicker">Dubai</div>
        <div class="sub">Asia/Dubai</div>
        <div class="value small" id="t_dubai">—</div>
      </div>

      <div class="card">
        <div class="kicker">Singapore</div>
        <div class="sub">Asia/Singapore</div>
        <div class="value small" id="t_singapore">—</div>
      </div>

      <div class="card">
        <div class="kicker">Vladivostok</div>
        <div class="sub">Asia/Vladivostok</div>
        <div class="value small" id="t_vladivostok">—</div>
      </div>

    </div>

    <div class="foot" id="status">Loading…</div>
  </div>

<script>
  // ====== CONFIG ======
  // Your Cloudflare Worker URL (Brent proxy)
  const BRENT_PROXY_URL = "https://restless-sound-2a88.mikhail-fsl.workers.dev/";

  // ====== HELPERS ======
  const fmt2 = (n) => Number(n).toLocaleString("en-GB", { maximumFractionDigits: 2 });
  const setText = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text; };

  // ====== CLOCKS ======
  const CLOCKS = [
    { id: "t_gmt",         tz: "Etc/GMT" },
    { id: "t_london",      tz: "Europe/London" },
    { id: "t_moscow",      tz: "Europe/Moscow" },
    { id: "t_dubai",       tz: "Asia/Dubai" },
    { id: "t_singapore",   tz: "Asia/Singapore" },
    { id: "t_vladivostok", tz: "Asia/Vladivostok" },
  ];

  function renderClocks(){
    for (const c of CLOCKS){
      const t = new Intl.DateTimeFormat("en-GB", {
        timeZone: c.tz,
        hour: "2-digit", minute: "2-digit", second: "2-digit",
        hourCycle: "h23"
      }).format(new Date());
      setText(c.id, t);
    }
  }
  renderClocks();
  setInterval(renderClocks, 1000);

  // ====== PRICES ======
  async function updateBTC() {
    // Coinbase spot (works in browser)
    const out = document.getElementById("btc");
    try {
      const r = await fetch("https://api.coinbase.com/v2/prices/BTC-USD/spot", { cache: "no-store" });
      const j = await r.json();
      const price = Number(j.data.amount);
      out.textContent = fmt2(price);
    } catch {
      out.textContent = "N/A";
    }
  }

  async function updateFX() {
    // Frankfurter (works in browser)
    const out = document.getElementById("fx");
    try {
      const r = await fetch("https://api.frankfurter.app/latest?from=GBP&to=USD", { cache: "no-store" });
      const j = await r.json();
      const rate = Number(j.rates.USD);
      out.textContent = fmt2(rate);
    } catch {
      out.textContent = "N/A";
    }
  }

  async function updateGold() {
    // Keep your existing gold number logic if you already have it.
    // If you currently have a working gold API in your file, paste it here.
    // For now: leave as-is (manual / placeholder).
    // If your current gold fetch works, replace this function with your existing one.
    const out = document.getElementById("gold");
    if (out.textContent === "—") out.textContent = "4,622.5"; // placeholder to match your current display
  }

  async function updateBrent() {
    // Brent via your Cloudflare Worker (browser-safe)
    const out = document.getElementById("brent");
    try {
      const r = await fetch(BRENT_PROXY_URL, { cache: "no-store" });
      const j = await r.json();
      out.textContent = j?.brent ? fmt2(j.brent) : "N/A";
    } catch {
      out.textContent = "N/A";
    }
  }

  async function updateAll() {
    setText("status", "Updating…");
    await Promise.allSettled([updateBTC(), updateGold(), updateBrent(), updateFX()]);
    setText("status", "Updated.");
  }

  updateAll();
  // BTC + FX can refresh often; Brent (24h delayed) doesn't need frequent refresh
  setInterval(updateBTC, 60 * 1000);
  setInterval(updateFX, 60 * 1000);
  setInterval(updateBrent, 60 * 60 * 1000); // hourly
</script>
</body>
</html>
